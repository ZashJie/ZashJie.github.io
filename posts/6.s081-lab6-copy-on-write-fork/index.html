<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="6.s081 lab6 - copy-on-write fork" /><meta name="author" content="ZashJie" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="#操作系统/6S081 什么是 COW 这是懒分配的一个方法，在fork的时候 让子进程一起使用父进程的内存，避免fork占有无意义的内存，在当占有的内存被使用时，才开始创建新的内存" /><meta property="og:description" content="#操作系统/6S081 什么是 COW 这是懒分配的一个方法，在fork的时候 让子进程一起使用父进程的内存，避免fork占有无意义的内存，在当占有的内存被使用时，才开始创建新的内存" /><link rel="canonical" href="/posts/6.s081-lab6-copy-on-write-fork/" /><meta property="og:url" content="/posts/6.s081-lab6-copy-on-write-fork/" /><meta property="og:site_name" content="岚雲" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-02-10T02:34:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="6.s081 lab6 - copy-on-write fork" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@ZashJie" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ZashJie"},"dateModified":"2024-02-10T02:34:00+00:00","datePublished":"2024-02-10T02:34:00+00:00","description":"#操作系统/6S081 什么是 COW 这是懒分配的一个方法，在fork的时候 让子进程一起使用父进程的内存，避免fork占有无意义的内存，在当占有的内存被使用时，才开始创建新的内存","headline":"6.s081 lab6 - copy-on-write fork","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/6.s081-lab6-copy-on-write-fork/"},"url":"/posts/6.s081-lab6-copy-on-write-fork/"}</script><title>6.s081 lab6 - copy-on-write fork | 岚雲</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="岚雲"><meta name="application-name" content="岚雲"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/config/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">岚雲</a></div><div class="site-subtitle font-italic">这里是岚雲的博客～</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ZashJie" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>6.s081 lab6 - copy-on-write fork</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>6.s081 lab6 - copy-on-write fork</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1707532440" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2024/02/10 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1205 字"> <em>6 分钟</em>阅读</span></div></div></div><div class="post-content"><p>#操作系统/6S081</p><h3 id="什么是-cow"><span class="mr-2">什么是 COW</span><a href="#什么是-cow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>这是懒分配的一个方法，在fork的时候 让子进程一起使用父进程的内存，避免fork占有无意义的内存，在当占有的内存被使用时，才开始创建新的内存</p><h3 id="实现要点"><span class="mr-2">实现要点</span><a href="#实现要点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>要怎么实现fork分配后，子进程使用父进程内存；<li>系统怎么知道你是父进程跟子进程一起使用的 通过COW处理的内存；<li>在子进程分配后，父进程虚拟页表并没有被处理，如何防止父进程的内存被再次分配；<li>父子进程指向同一个虚拟内存时，如何保证物理地址不被重复释放；<li>物理页表的引用计数，如何避免静态竞争导致所导致的错误；<li>- 大概要点就这么多吧</ul><h3 id="代码实现"><span class="mr-2">代码实现</span><a href="#代码实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h5 id="kernelkalloch"><span class="mr-2"><code class="language-plaintext highlighter-rouge">kernel/kalloc.h</code></span><a href="#kernelkalloch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
</pre><td class="rouge-code"><pre>```c
===-
struct spinlock pgreflock;
#define paNum(pa) ((pa - KERNBASE)/PGSIZE)
#define PG_MAX_NUM paNum(PHYSTOP)
int paref_ID[PG_MAX_NUM];
#define PA_REF(pa) paref_ID[paNum((uint64)pa)]
-===

struct {
struct spinlock lock;
struct run *freelist;
===-
int cnt;
-===
} kmem;

void
kinit()
{
initlock(&amp;kmem.lock, "kmem");
===-
initlock(&amp;pgreflock, "pgref");
-===
freerange(end, (void*)PHYSTOP);
}

void
kfree(void *pa)
{
struct run *r;

if(((uint64)pa % PGSIZE) != 0 || (char*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)
    panic("kfree");
===-
acquire(&amp;pgreflock);
if (--PA_REF(pa) &lt;= 0) {
-===
    // Fill with junk to catch dangling refs.
    memset(pa, 1, PGSIZE);

    r = (struct run*)pa;

    acquire(&amp;kmem.lock);
    r-&gt;next = kmem.freelist;
    kmem.freelist = r;
    release(&amp;kmem.lock);
    ===-
}
release(&amp;pgreflock);
-===
}

void *
kalloc(void)
{
struct run *r;

acquire(&amp;kmem.lock);
r = kmem.freelist;
if(r)
    kmem.freelist = r-&gt;next;
release(&amp;kmem.lock);

if(r) {
    memset((char*)r, 5, PGSIZE); // fill with junk
    ===-
    PA_REF(r) = 1;
    -===
}
return (void*)r;
}

===-
// 当遇到cow虚拟页时，看引用计数去对应分配内存
void*
cow_copy(void* pa)
{
uint64 mem;
acquire(&amp;pgreflock);
if (PA_REF(pa) &lt;= 1) {
    release(&amp;pgreflock);
    return pa;
}
mem = (uint64)kalloc();
if (mem == 0) {
    release(&amp;pgreflock);
    return 0;
}
memmove((void*)mem, pa, PGSIZE);
PA_REF(pa) -= 1;
release(&amp;pgreflock);
return (void*)mem;

acquire(&amp;pgreflock);
}
// 查看物理页的引用计数
int inspectPaRef(uint64 pa) {
return PA_REF(pa);
}

void
increace_ref(void* pa) {
acquire(&amp;pgreflock);
PA_REF(pa)++;
release(&amp;pgreflock);
}
-===

```

##### `kernel/risc.h`

```c
#define PTE_RSW (1L &lt;&lt; 8)
```

##### `kernel/trap.c`

```c
void
usertrap(void)
{
int which_dev = 0;

if((r_sstatus() &amp; SSTATUS_SPP) != 0)
    panic("usertrap: not from user mode");

// send interrupts and exceptions to kerneltrap(),
// since we're now in the kernel.
w_stvec((uint64)kernelvec);

struct proc *p = myproc();

// save user program counter.
p-&gt;trapframe-&gt;epc = r_sepc();

if(r_scause() == 8){
    // system call

    if(p-&gt;killed)
    exit(-1);

    // sepc points to the ecall instruction,
    // but we want to return to the next instruction.
    p-&gt;trapframe-&gt;epc += 4;

    // an interrupt will change sstatus &amp;c registers,
    // so don't enable until done with those registers.
    intr_on();

    syscall();
} else if((which_dev = devintr()) != 0){
    // ok
===-
} else if ((r_scause() == 13 || r_scause() == 15) &amp;&amp; inspectpte(r_stval())) {
    if (uvmcowrealcopy(r_stval()) == -1) {
    p-&gt;killed = 1;
    }
}
-===  
else {
    printf("usertrap(): unexpected scause %p pid=%d\n", r_scause(), p-&gt;pid);
    printf("            sepc=%p stval=%p\n", r_sepc(), r_stval());
    p-&gt;killed = 1;
}

if(p-&gt;killed)
    exit(-1);

// give up the CPU if this is a timer interrupt.
if(which_dev == 2)
    yield();

usertrapret();
} ```
</pre></table></code></div></div><h5 id="kernelvmc"><span class="mr-2"><code class="language-plaintext highlighter-rouge">kernel/vm.c</code></span><a href="#kernelvmc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre><td class="rouge-code"><pre>```c
===-
int
uvmcowlazycopy(pagetable_t old, pagetable_t new, uint64 sz) {
pte_t *pte;
uint64 pa, i;
uint flags;

for (i = 0; i &lt; sz; i += PGSIZE) {
    if ((pte = walk(old, i, 0)) == 0)
    panic("uvmlazycopy: pte should exist");
    if ((*pte &amp; PTE_V) == 0)
    panic("uvmlazycopy: page not present");
    pa = PTE2PA(*pte);
    if (*pte &amp; PTE_W) {
    *pte = (*pte &amp; ~PTE_W) | PTE_RSW;
    }
    
    flags = PTE_FLAGS(*pte);
    
    if(mappages(new, i, PGSIZE, pa, flags) != 0){
    goto err;
    }
    increace_ref((void*) pa);
}
return 0;

err:
uvmunmap(new, 0, i / PGSIZE, 1);
return -1;
}

int
uvmcowrealcopy(uint64 va) {

pte_t *pte;
uint64 pa;
struct proc *p = myproc();
uint64 mem;
uint flag;


if ((pte = walk(p-&gt;pagetable, va, 0)) == 0) {
    vmprint(p-&gt;pagetable, 0);
    panic("uvmcowrealcopy: pte should exist");
}
pa = PTE2PA(*pte);
// if (inspectPaRef(pa) == 1) {
//   mem = pa;
// } else {
mem = (uint64)cow_copy((void*) pa);
// }
if (mem == 0) return -1;

flag = (PTE_FLAGS(*pte) | PTE_W) &amp; ~PTE_RSW;
uvmunmap(p-&gt;pagetable, PGROUNDDOWN(va), 1, 0);

if (mappages(p-&gt;pagetable, va, 1, mem, flag) == -1) 
    panic("uvmcowrealcopy: mappages");

return 0;
}

int
inspectpte(uint64 va) {
pte_t *pte;
struct proc *p = myproc();

return va &lt; p-&gt;sz &amp;&amp;
((pte = walk(p-&gt;pagetable, va, 0)) != 0) &amp;&amp;
(*pte &amp; PTE_RSW) &amp;&amp; 
(*pte &amp; PTE_V);
}
-===

int
copyout(pagetable_t pagetable, uint64 dstva, char *src, uint64 len)
{
uint64 n, va0, pa0;

while(len &gt; 0){
===-
    if (inspectpte(dstva)) {
    uvmcowrealcopy(dstva);
    }
-===
    va0 = PGROUNDDOWN(dstva);
    pa0 = walkaddr(pagetable, va0);
    if(pa0 == 0)
    return -1;
    n = PGSIZE - (dstva - va0);
    if(n &gt; len)
    n = len;
    memmove((void *)(pa0 + (dstva - va0)), src, n);

    len -= n;
    src += n;
    dstva = va0 + PGSIZE;
}
return 0;
}
```
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/'>计算机</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-6s081/" class="post-tag no-text-decoration" >操作系统/6S081</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=6.s081%20lab6%20-%20copy-on-write%20fork%20-%20%E5%B2%9A%E9%9B%B2&url=%2Fposts%2F6.s081-lab6-copy-on-write-fork%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=6.s081%20lab6%20-%20copy-on-write%20fork%20-%20%E5%B2%9A%E9%9B%B2&u=%2Fposts%2F6.s081-lab6-copy-on-write-fork%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2F6.s081-lab6-copy-on-write-fork%2F&text=6.s081%20lab6%20-%20copy-on-write%20fork%20-%20%E5%B2%9A%E9%9B%B2" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/muduo-%E7%BD%91%E7%BB%9C%E5%BA%93%E5%B9%B6%E5%8F%91%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">muduo 网络库并发框架设计与实现</a><li><a href="/posts/%E5%9F%BA%E4%BA%8E%E5%8F%8C%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/">基于双缓冲区的日志系统</a><li><a href="/posts/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/">归并排序</a><li><a href="/posts/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/">快速排序</a><li><a href="/posts/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/">插入排序</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E8%AF%AD%E8%A8%80-cpp/">语言/CPP</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-6s081-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">操作系统/6S081/源码解析</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/">算法/排序</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-6s081/">操作系统/6S081</a> <a class="post-tag" href="/tags/%E7%BD%91%E7%BB%9C-tcp/">网络/TCP</a> <a class="post-tag" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/6.s081-lab7-Multhreading/"><div class="card-body"> <em class="small" data-ts="1707532440" data-df="YYYY/MM/DD" > 2024/02/10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.s081 lab7 Multhreading</h3><div class="text-muted small"><p> #操作系统/6S081 Uthread: switching between threads 题目一开始就提供的 uthread.c 实验目的 补充一个三线程一次从0增加到100，在题目给出的代码中，缺少的是： 线程间寄存器的切换 汇编代码 线程的上下文定义 线程上下文的初始化 要着重注意 返回地址 和 栈指针指向 - use...</p></div></div></a></div><div class="card"> <a href="/posts/6.S081-lab3-pgtbl/"><div class="card-body"> <em class="small" data-ts="1704422040" data-df="YYYY/MM/DD" > 2024/01/05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>xv6 console.c 文件代码解析</h3><div class="text-muted small"><p> #操作系统/6S081 打印页表 实验要求以及注意点 将每一级对应的页表映射打印输出出来，打印出每个 pte 对应的 物理地址 可以参照 freewalk 函数是怎么遍历三级页表找到最终的物理地址的 不要打印非法的pte，也就是没有分配的pte是不需要进行打印的 所需的源码理解 [[xv6 源码解析 - pagetable_t]] [[xv6 源码解析 - p...</p></div></div></a></div><div class="card"> <a href="/posts/xv6-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-allocproc-%E5%87%BD%E6%95%B0/"><div class="card-body"> <em class="small" data-ts="1705718040" data-df="YYYY/MM/DD" > 2024/01/20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>xv6 源码解析 - allocproc 函数</h3><div class="text-muted small"><p> #操作系统/6S081/源码解析 code ```C // Look in the process table for an UNUSED proc. // If found, initialize state required to run in the kernel, // and return with p-&amp;gt;lock held. // If there are no free...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/xv6-console.c-%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/" class="btn btn-outline-primary" prompt="上一篇"><p>xv6 console.c 文件代码解析</p></a> <a href="/posts/6.s081-lab7-Multhreading/" class="btn btn-outline-primary" prompt="下一篇"><p>6.s081 lab7 Multhreading</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E8%AF%AD%E8%A8%80-cpp/">语言/CPP</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-6s081-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">操作系统/6S081/源码解析</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95-%E6%8E%92%E5%BA%8F/">算法/排序</a> <a class="post-tag" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-6s081/">操作系统/6S081</a> <a class="post-tag" href="/tags/%E7%BD%91%E7%BB%9C-tcp/">网络/TCP</a> <a class="post-tag" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/username">ZashJie</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
